webpackJsonp([22],{534:function(e,a,t){t(760);var r=t(132)(t(608),t(702),null,null);e.exports=r.exports},608:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});t(190);a.default={data:function(){var e=this,a=function(a,t,r){""===t?r(new Error("请再次输入密码!")):t!==e.register.password?r(new Error("两次密码不相同!")):r()},t=function(e,a,t){var r=/^[a-zA-Z0-9]+$/;a.match(r)?t():t(new Error("密码仅可由数字与字母组成"))},r=function(e,a,t){var r=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？\\\\]");a.indexOf(" ")>=0?t(new Error("请不要包含空格")):a.match(r)?t(new Error("请不要输入特殊字符")):a.gblen()<4||a.gblen()>16?t(new Error("请输入4-16位字符")):t()};return{hostUrl:"/VR",imgUrl:"/VR/checkcode",data:{code:200},addNewVisible:!1,register:{username:"",nickname:"",password:"",repassword:"",verCode:""},registerRules:{username:[{required:!0,message:"请输入Email",trigger:"blur"},{type:"email",message:"请输入正确的Email格式",trigger:"change"},{type:"email",message:"请输入正确的Email格式",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{validator:r,trigger:"change"},{validator:r,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:t,trigger:"change"},{validator:t,trigger:"blur"},{min:6,max:16,message:"长度在6-16之间",trigger:"change"},{min:6,max:16,message:"长度在6-16之间",trigger:"blur"}],repassword:[{validator:a,trigger:"change"},{validator:a,trigger:"blur"}],verCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},itmpPageNum:0,itmpPageTotal:0,iupsaleText:"",iupPageNum:1,iupPageTotal:20,iupPageSize:20,iupPages:1,allData1:[],tableData1:[]}},methods:{codeParsing:function(e){var a=this,t=function(e,t){a.$notify({title:e,message:t,type:"error"})};switch(e){case-1:t("系统错误","未知错误，请上报管理员");break;case 201:t("输入域错误","验证码错误");break;case 300:t("输入域错误","邮箱或密码错误");break;case 301:t("权限问题","用户已禁用，请联系管理员");break;case 302:t("权限问题","用户未激活，请去邮箱激活用户");break;case 303:t("注册问题","邮箱已占用，请更改邮箱");break;case 304:t("注册问题","昵称已占用，请更改昵称");break;case 401:t("权限问题","用户无权访问，请联系管理员");break;case 402:t("操作错误","删除错误,请刷新重试");break;case 415:t("操作错误","文件类型错误，请上传正确文件类型");break;case 500:t("系统错误","未知错误，请上报管理员");break;case 600:t("TIME_OUT","访问超时，请检查网络连接");break;case 700:t("激活错误","非法激活链接，请联系管理员");break;case 800:t("激活错误","用户已被激活，请直接登录");break;case 1e3:t("系统错误","参数错误，上报管理员");break;case 1001:t("权限问题","用户未登录，请重新登录");break;case 1002:t("系统错误","参数错误，上报管理员")}},handleDisabled:function(e){var a=this;return console.log("activated: "+a.tableData1[e].activated),1==a.tableData1[e].activated},handleToOffsale1:function(e){var a=this,t=[a.tableData1[e]],r=a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})}),i=r.banned;a.tableData1[e].banned=0==i?1:0,a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})}).banned=0==i?1:0,0==i?a.$axios({url:"admin/activatedUser/"+r.id,method:"post",baseURL:a.hostUrl}).then(function(e){console.log(r.id),a.$message("用户"+r.nickname+"禁用成功！")}).catch(function(e){console.log(e)}):1==i&&a.$axios({url:"admin/banUser/"+r.id,method:"post",baseURL:a.hostUrl}).then(function(e){console.log(r.id),a.$message("用户"+r.nickname+"激活成功！")}).catch(function(e){console.log(e)})},handleDelete1:function(e){var a=this,t=[a.tableData1[e]],r=a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})});a.allData1=a.allData1.filter(function(e){return!t.some(function(a){return a.id===e.id})}),a.handleIUpsaleSearch(),a.$axios({url:"admin/deleteUser/"+r.id,method:"post",baseURL:a.hostUrl}).then(function(e){a.data=e.data,200==a.data.code?a.$message("用户"+r.nickname+"删除成功！"):a.codeParsing(a.data.code)}).catch(function(e){console.log(e)})},getPartProducts1:function(e){console.log("page: "+e);var a=this;if(a.itmpPageNum=e,a.tableData1=[],a.iupPageTotal=a.allData1.length,0!=a.iupPageTotal){a.iupPages=Math.ceil(a.iupPageTotal/a.iupPageSize);var t=e==a.iupPages?a.iupPageTotal%a.iupPageSize==0?a.iupPageSize:a.iupPageTotal%a.iupPageSize:a.iupPageSize;console.log("size: "+t);for(var r=0;r<t;r++)a.tableData1.push(a.allData1[(e-1)*a.iupPageSize+r]);console.log("succ")}},handleIUpsaleChange:function(){var e=this;console.log("current-Page:"),console.log(e.iupPageNum),e.getPartProducts1(e.iupPageNum)},getProducts1:function(){var e=this;e.$axios({url:"admin/getAllUsers",method:"get",baseURL:e.hostUrl}).then(function(a){e.data=a.data,200==e.data.code?(e.allData1=a.data.object.users,e.getPartProducts1(1)):e.codeParsing(e.data.code)}).catch(function(e){console.log(e)})},handleIUpsaleSearch:function(){var e=this;console.log(e.iupsaleText);var a=e.iupsaleText.trim();if(""!=a){e.tableData1=[];for(var t=0;t<e.allData1.length;t++)-1!=e.allData1[t].nickname.toLowerCase().indexOf(a)&&e.tableData1.push(e.allData1[t]);e.iupPageTotal=e.tableData1.length,e.iupPages=Math.ceil(e.iupPageTotal/e.iupPageSize)}else e.iupPageTotal=e.itmpPageTotal,e.iupPages=Math.ceil(e.iupPageTotal/e.iupPageSize),e.getPartProducts1(e.itmpPageNum)},handleEmailState:function(e){var a=this,t=[a.tableData1[e]],r=a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})}),i=r.activated;a.tableData1[e].activated=0==i?1:0,a.tableData1[e].disabled=0==i,a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})}).activated=0==i?1:0,a.allData1.find(function(e){return t.some(function(a){return a.id===e.id})}).disabled=0==i,a.$axios({url:"admin/activeUser/"+r.id,method:"post",baseURL:a.hostUrl}).then(function(e){a.data=e.data,200==a.data.code?a.$message("邮箱"+r.email+"激活成功！"):a.codeParsing(a.data.code)}).catch(function(e){console.log(e)})},registerForm:function(e){var a=this,t=this;t.addNewVisible=!1,t.$refs[e].validate(function(e){if(!e)return console.log("error register!!"),a.$message({title:"格式错误",message:"请检查输入域是否正确",type:"error"}),!1;var r=a.$createElement;a.$notify({title:"注册信息",message:r("pre",{style:"color: teal"},"\n邮箱: "+a.register.username+"\n昵称: "+a.register.nickname+"\n密码: "+a.register.repassword)}),a.$axios({url:"/admin/addUser",method:"post",baseURL:a.hostUrl,data:{email:a.register.username,password:a.register.password,checkcode:a.register.verCode,nickname:a.register.nickname}}).then(function(e){200===e.data.code?(a.$notify({title:"成功",message:"注册成功!",type:"success"}),t.getVerCode(),t.getProducts1()):(console.log(e.data.code),t.codeParsing(e.data.code))}).catch(function(e){a.$notify({title:"失败",message:"注册失败: 请重试!",type:"error"}),console.log("【Error】:",e)})})},changeUrl:function(){var e=this.imgUrl,a=(new Date).valueOf();return e=e.substring(0,45),e=e.indexOf("&")>=0?e+"xtamp="+a:e+"?timestamp="+a},getVerCode:function(){var e=this;e.imgUrl=e.changeUrl()}},mounted:function(){},created:function(){var e=this;console.log("get products list"),e.getProducts1()}}},633:function(e,a,t){a=e.exports=t(58)(void 0),a.push([e.i,".content{float:left;width:70%}.search-input{width:200px;margin-left:10px}.table-title{font-size:20px;color:#324157;font-weight:700;margin:10px}.operation{margin:0 0 10px 10px}",""])},702:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("el-row",[t("div",{staticClass:"table-title"},[e._v("用户管理")]),e._v(" "),t("div",{staticClass:"operation"},[t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.addNewVisible=!0}}},[e._v("新增用户")]),e._v(" "),t("el-dialog",{attrs:{title:"填写新用户信息",visible:e.addNewVisible},on:{"update:visible":function(a){e.addNewVisible=a}}},[t("el-form",{ref:"register",attrs:{model:e.register,rules:e.registerRules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{placeholder:"邮箱"},model:{value:e.register.username,callback:function(a){e.register.username=a},expression:"register.username"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"nickname"}},[t("el-input",{attrs:{placeholder:"昵称"},model:{value:e.register.nickname,callback:function(a){e.register.nickname=a},expression:"register.nickname"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{type:"password",placeholder:"请输入6-16位密码"},model:{value:e.register.password,callback:function(a){e.register.password=a},expression:"register.password"}})],1),e._v(" "),t("el-form-item",{attrs:{prop:"repassword"}},[t("el-input",{attrs:{type:"password",placeholder:"确认密码"},model:{value:e.register.repassword,callback:function(a){e.register.repassword=a},expression:"register.repassword"}})],1),e._v(" "),t("el-form",{ref:"register",attrs:{model:e.register,rules:e.registerRules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"verCode"}},[t("el-popover",{ref:"b",attrs:{placement:"right-end",trigger:"hover"}},[t("img",{attrs:{src:e.imgUrl,alt:"验证码图片",width:"200px"},on:{click:e.getVerCode}})]),e._v(" "),t("el-input",{directives:[{name:"popover",rawName:"v-popover:b",arg:"b"}],attrs:{placeholder:"验证码"},model:{value:e.register.verCode,callback:function(a){e.register.verCode=a},expression:"register.verCode"}})],1)],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",slot:"footer"},[t("el-button",{on:{click:function(a){e.addNewVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(a){e.registerForm("register")}}},[e._v("确 定")])],1)],1),e._v(" "),t("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入用户名",icon:"search","on-icon-click":e.handleIUpsaleSearch},on:{change:e.handleIUpsaleSearch},model:{value:e.iupsaleText,callback:function(a){e.iupsaleText=a},expression:"iupsaleText"}})],1),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData1,border:""}},[t("el-table-column",{attrs:{prop:"nickname",label:"用户名",width:"200"}}),e._v(" "),t("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),t("el-table-column",{attrs:{prop:"activated",label:"邮箱状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{disabled:e.handleDisabled(a.$index),size:"small"},on:{click:function(t){e.handleEmailState(a.$index)}}},[e._v(e._s(0==e.tableData1[a.$index].activated?"待激活":"已激活"))])]}}])}),e._v(" "),t("el-table-column",{attrs:{width:"160",label:"用户账号操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{plain:!0,size:"small"},on:{click:function(t){e.handleToOffsale1(a.$index)}}},[e._v(e._s(1==e.tableData1[a.$index].banned?"激活":"禁用"))])]}}])}),e._v(" "),t("el-table-column",{attrs:{width:"120",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){e.handleDelete1(a.$index)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),t("el-row",[t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.iupPageNum,"page-size":e.iupPageSize,layout:"total, prev, pager, next",total:e.iupPageTotal},on:{"current-change":e.handleIUpsaleChange,"update:currentPage":function(a){e.iupPageNum=a}}})],1)])],1)},staticRenderFns:[]}},760:function(e,a,t){var r=t(633);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t(133)("b2691336",r,!0)}});